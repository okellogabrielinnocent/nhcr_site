<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="IntraHealth">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Decision Rules - NHCR (Uganda) Documentation</title>
  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Decision Rules";
    var mkdocs_page_input_path = "admin/decision_rules.md";
    var mkdocs_page_url = "/planetsystems/OpenCR/admin/decision_rules/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> NHCR (Uganda) Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Home</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../..">Welcome!</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/process/">Matching Process</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/recordlinkage/">Record Linkage Process</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/usecases/">Use Cases</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/ui/">UI -- Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/ui-advanced/">UI -- Human Adjudication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/openmrs/">OpenMRS MPI Client</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/cruid/">Unique Identifiers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/algos/">Intro to Algorithms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/supported/">Supported Algorithms</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Implementer</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user/guide/">OpenHIE Implementation Guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../../impl/roles/">Roles and Responsibilities</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user/resources/">Additional Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../dev/addalgos/">Add Algorithms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/docs/">Building Documentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/license/">License</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/contributing/">Contributing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Sysadmin</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../proficiencies/">Proficiencies</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../internals/">Internals</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Getting Started (Docker)</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../docker/">Local Installation using Docker</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../queries/">Example API Query (cURL)</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../notebooks/basic_query_in_python.ipynb">None</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Decision Rules</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#decision-rules">Decision Rules</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l5" href="#how-to-set-decision-rules">How to Set Decision Rules</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../requirements/">System Requirements</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../method/">Choosing a Method</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configuration/">Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../installation/">Local Installation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../installation_full/">Server Installation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../ansible/">Ansible</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Load Bulk Data</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../loadjs/">Load Demo Data (JavaScript)</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../notebooks/load_bulk_data_in_python.ipynb">None</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Production Considerations</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../security/">Security</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../backup/">Backup and Recovery</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../troubleshooting/">Troubleshooting</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">NHCR (Uganda) Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started (Docker) &raquo;</li>
        
      
        
          <li>Sysadmin &raquo;</li>
        
      
    
    <li>Decision Rules</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/planetsystems/OpenCR/edit/master/docs/admin/decision_rules.md"> Edit on ministryofhealth/nhcr</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="decision-rules">Decision Rules</h1>
<h2 id="overview">Overview</h2>
<p>Demographic data from submitting systems is stored in HAPI FHIR. It is also recommended that the demographic data that is primarily stored in HAPI FHIR be indexed into Elasticsearch.</p>
<p>For match processing, there are two options. One is run in mediator-only mode, which is highly flexible and supports a handful of algorithms that can be chained together. Additional algorithms can be added as needed. </p>
<p>The second is to use ES. ES is very fast and supports compound queries but currently only supports Levenshtein distance.  When using ES, every request to the FHIR Server is cached in ES.</p>
<p>(One additional caveat for Levenshtein distance is that the mediator-only matching can support edit distances exceeding two, while ES edit distance cannot exceed two.)</p>
<p>Every client wishing to use the Client Registry must be authenticated and authorized. See the configuration page for more information. </p>
<h2 id="how-to-set-decision-rules">How to Set Decision Rules</h2>
<p>Decision rules determine how matches are made among records, for example, by using a certain algorithm on one field and a different algorithm on another. </p>
<p>Let's use the below example:</p>
<p><code>rules.givenName</code> is used as one rule on the field givenName.</p>
<p><code>rules.givenName.algorithm</code> defines an algorithm, in this instance Jaro-Winkler, and an threshold for that algorithm unique to it.</p>
<p><code>rules.givenName.path</code> is a required FHIRpath for the fields, a standard way to define how to traverse a FHIR resource. In future, a GUI may be used for defining the FHIRpath.</p>
<p>By default, all of the rules are chained together in a logical AND statement. In ES the search queries are assembled into compound queries.</p>
<p><a href="https://github.com/openhie/client-registry/blob/master/server/config/decision_rules.json">Link to file</a></p>
<p>Contents of <code>server/config/decision_rules.json</code></p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;__comments&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;Its a fhir path, for syntax refer to https://www.hl7.org/fhir/fhirpath.html&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String, Date, Number or Boolean&quot;</span><span class="p">,</span>
    <span class="nt">&quot;threshold&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;levenshtein&quot;</span><span class="p">:</span> <span class="s2">&quot;Lower the number, the closer the match, 0 being exact match&quot;</span><span class="p">,</span>
      <span class="nt">&quot;jaro-winkler&quot;</span><span class="p">:</span> <span class="s2">&quot;number between 0 and 1, where 0 for no match and 1 for exact match&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;jaro-winkler&quot;</span><span class="p">,</span>
      <span class="nt">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.89</span><span class="p">,</span>
      <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;name.where(use=&#39;official&#39;).last().given&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
      <span class="nt">&quot;systems&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;system1&quot;</span><span class="p">,</span> <span class="s2">&quot;system2&quot;</span><span class="p">,</span> <span class="s2">&quot;system3&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;familyName&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;damerau-levenshtein&quot;</span><span class="p">,</span>
      <span class="nt">&quot;threshold&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;name.where(use=&#39;official&#39;).last().family&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;gender&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;exact&quot;</span><span class="p">,</span>
      <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;gender&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../requirements/" class="btn btn-neutral float-right" title="System Requirements">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../notebooks/basic_query_in_python.ipynb" class="btn btn-neutral" title="None"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2022 MoH</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../notebooks/basic_query_in_python.ipynb" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../requirements/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
